<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Webscripting2 &mdash; Serverside Webscripting &mdash; 05.silex.part3</title>

		<meta name="description" content="Webscripting2 &mdash; Serverside Webscripting &mdash; 05.silex.part3">
		<meta name="author" content="Bram(us) Van Damme - ikdoeict.be">

		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">
	</head>

	<body>

		<div id="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- Title -->
				<section>
					<section>
						<h3 class="inverted">Serverside Webscripting <small>[JLW280]</small></h3>
						<h1>05.silex.part3</h1>

						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:bramus.vandamme@kahosl.be">bramus.vandamme@kahosl.be</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>
				</section>




				<!-- Built-in Service Provider: UrlGeneratorServiceProvider -->
				<section>
					<section>
						<h2>Built-in Service Provider:<br />UrlGeneratorServiceProvider</h2>

						<p><img src="assets/05/futurama_bender_terminator.jpg" width="580" alt="" /></p>
						<q>001100010010011110100001101101110011</q>
					</section>

					<section>
						<h2>UrlGeneratorServiceProvider</h2>
						<ul>
							<li class="fragment">
								Silex Routes can be named
								<pre class="bigger"><code class="language-php">$app->get('/', function () {
	return 'welcome to the homepage';
})->bind('homepage');

$app->get('/hello/{name}', function ($name) {
	return "Hello $name!";
})->bind('hello');</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">The UrlGenerator Service Provider<small><a href="http://silex.sensiolabs.org/doc/providers/url_generator.html">&#9873;</a></small> allows you to reference those routes in your App and via Twig</li>
						</ul>

					</section>

					<section>
						<h2>Inclusion</h2>
						<ul>
							<li class="fragment">
								If you want to use the shorthand functions within Twig templates, require <code>symfony/twig-bridge</code> in <code>composer.json</code>
								<pre class="bigger"><code>&quot;require&quot;: {
	&quot;symfony/twig-bridge&quot;: &quot;2.*&quot;
}</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Register the service in <code>bootstrap.php</code>
								<pre class="bigger"><code class="language-php">$app->register(new Silex\Provider\UrlGeneratorServiceProvider());</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Usage</h2>
						<ul>
							<li class="fragment">
								In PHP
								<pre class="bigger"><code class="language-php">$app['url_generator']->generate('homepage');</code></pre>
								<pre class="bigger"><code class="language-php">$app['url_generator']->generate('hello', array('name' => 'Bramus')); 
// -&gt; `/hello/Bramus`</code></pre>
							</li>
							<li class="fragment">
								In Twig
								<pre class="bigger"><code class="no-highlight">{{ app.url_generator.generate('homepage') }}</code></pre>
							</li>
							<li class="fragment">
								In Twig, using <code>twig-bridge</code>
								<pre class="bigger"><code class="no-highlight">{{ path('homepage') }} <span style="opacity: 0.75">{# -&gt; `/` #}</span></code></pre>
								<pre class="bigger"><code class="no-highlight">{{ url('homepage') }} <span style="opacity: 0.75">{# -&gt; `http://example.org/` #}</span></code></pre>
								<pre class="bigger"><code class="no-highlight">{{ path('hello', {name: 'Bramus'}) }} <span style="opacity: 0.75">{# -&gt; `/hello/Bramus` #}</span></code></pre>
								<pre class="bigger"><code class="no-highlight" style="white-space: nowrap; overflow: hidden;">{{ url('hello', {name: 'Bramus'}) }} <span style="opacity: 0.75">{# -&gt; `http://example.org/hello/Bramus` #}</span></code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Sidenote: Static pages</h2>
						<ul>
							<li class="fragment">
								Writing controllers for static pages is overkill. Here's a simple way to do it (in <code>app.php</code>)
							</li>
						</ul>
						<pre class="bigger fragment"><code class="language-php">$pages = array(
		'/' =&gt; 'home',
		'/about' =&gt; 'about'
	);
	foreach ($pages as $route =&gt; $view) {
		$app-&gt;get($route, function () use ($app, $view) {
			return $app['twig']->render('static/' . $view . '.twig');
		})-&gt;bind($view);
	}
}</code></pre>
						<footer class="fragment">Place static page templates in <code>/src/views/static/</code></footer>
					</section>

					<section>
						<h2>Example</h2>

						<figure><img src="assets/05/example-08.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at <code>assets/ws2-sws-fiddles-silex/08.static-pages/</code> <a href="assets/ws2-sws-fiddles-silex/08.static-pages/">&rarr;</a></p>
					</section>

					<section>
						<h2>Example Recap</h2>

						<ul>
							<li class="fragment">
								Place static page templates in <code>/src/views/static/</code>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Give routes a name using <code>bind()</code> within the <code>connect()</code> function of the controller
							</li>
							<li class="fragment" style="margin-top: 1em;">
								No need for <code>{{ app.request.baseUrl }}</code> in Twig anymore as <code>{{ path('links') }}</code> includes it
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Extract parts of the URL in Twig using <code>app.request.getPathInfo()|split('/')[1]</code>
							</li>
						</ul>
					</section>

				</section>




				<!-- Built-in Service Provider: MonologServiceProvider -->
				<section>
					<section>
						<h2>Built-in Service Provider:<br />MonologServiceProvider</h2>

						<p><img src="assets/05/futurama-control.png" width="580" height="280" alt="" /></p>
						<q>Captain's log: We have lost control of the ship.<br />Adddendum: Whoooaaaa!</q>
					</section>

					<section>
						<h2>MonologServiceProvider</h2>
						<ul>
							<li class="fragment">The MonologServiceProvider<small><a href="http://silex.sensiolabs.org/doc/providers/monolog.html">&#9873;</a></small> provides a default logging mechanism through the <a href="https://github.com/Seldaek/monolog">Monolog library</a>.</li>
							<li class="fragment" style="margin-top: 1em;">
								Monolog log levels
								<div class="columns" style="font-size: 80%">
									<div class="column column-12">
										<ul>
											<li>
												<code>DEBUG</code> <em style="font-size: 80%">(100)</em>
												<ul><li>Detailed debug information</li></ul>
											</li>
											<li>
												<code>INFO</code> <em style="font-size: 80%">(200)</em>
												<ul><li>Interesting events.<br />e.g. User logs in, SQL logs</li></ul>
											</li>
											<li>
												<code>NOTICE</code> <em style="font-size: 80%">(250)</em>
												<ul><li>Normal but significant events</li></ul>
											</li>
											<li>
												<code>WARNING</code> <em style="font-size: 80%">(300)</em>
												<ul><li>Exceptional occurrences that are not errors.<br />e.g. Use of deprecated APIs</li></ul>
											</li>
										</ul>
									</div>
									<div class="column column-12">
										<ul>
											<li>
												<code>ERROR</code> <em style="font-size: 80%">(400)</em>
												<ul><li>Runtime errs that don't need immediate action</li></ul>
											</li>
											<li>
												<code>CRITICAL</code> <em style="font-size: 80%">(500)</em>
												<ul><li>Critical conditions.<br />e.g. unexpected exception</li></ul>
											</li>
											<li>
												<code>ALERT</code> <em style="font-size: 80%">(550)</em>
												<ul><li>Action must be taken immediately.<br />e.g.database unavailable</li></ul>
											</li>
											<li>
												<code>EMERGENCY</code> <em style="font-size: 80%">(600)</em>
												<ul><li>Emergency: system is unusable</li></ul>
											</li>
										</ul>
									</div>
								</div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Inclusion</h2>
						<ul>
							<li class="fragment">
								Require <code>monolog/monolog</code> in <code>composer.json</code>
								<pre class="bigger"><code>&quot;require&quot;: {
	&quot;monolog/monolog&quot;: &quot;>=1.0.0&quot;
}</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Register the service in <code>bootstrap.php</code>
								<pre class="bigger"><code class="language-php">$app-&gt;register(new Silex\Provider\MonologServiceProvider(), array(
	'monolog.logfile' =&gt; __DIR__ . '/development.log',
));</code></pre>
								<ul>
									<li>
										Registration parameters
										<ul>
											<li><code>monolog.logfile</code> &mdash; Location of logfile</li>
											<li><code>monolog.level</code> <em>(optional)</em> &mdash; Minimum log level before event is written in log. Default: <code>Monolog\Logger::DEBUG</code></li>
											<li><code>monolog.name</code> <em>(optional)</em> &mdash; Name of the monolog channel.<br />Default: <code>myapp</code></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Usage</h2>
						<ul>
							<li class="fragment">
								Log events through <code>$app['monolog']</code>
								<pre class="bigger fragment"><code class="language-php">$app['monolog']-&gt;addDebug('Testing the Monolog logging.');</code></pre>
								<pre class="bigger fragment"><code class="language-php">$app['monolog']-&gt;addInfo(sprintf('User &quot;%s&quot; registered.', $username));</code></pre>
								<pre class="bigger fragment"><code class="language-php">$app['monolog']-&gt;addWarning('The use of global is deprecated');</code></pre>
								<pre class="bigger fragment"><code class="language-php">$app['monolog']-&gt;addError('Could not update item in database');</code></pre>
							</li>
							<li class="fragment">
								Sample output
								<pre class="bigger fragment"><code class="no-highlight">[2013-03-25 15:12:55] myapp.DEBUG: Testing the Monolog logging.
[2013-03-25 15:12:56] myapp.INFO: User &quot;Bramus&quot; registered.
[2013-03-25 15:12:57] myapp.WARNING: The use of global is deprecated
[2013-03-25 15:12:58] myapp.ERROR: Could not update item in database</code></pre>
							</li>
						</ul>
					</section>

				</section>




				<!-- Middleware -->
				<section>
					<section>
						<h2>Middlewares</h2>

						<p><img src="assets/05/futurama-middle-of-nowhere.png" width="447" alt="" /></p>
						<q>OK. We're in the middle of nowhere,<br />which is the safest part of nowhere.</q>
					</section>

					<section>
						<h2>Middlewares</h2>

						<ul>
							<li class="fragment">
								Silex apps are executed in different stages
								<ul>
									<li>Bootstrapping of the app</li>
									<li>Execution of the controller</li>
									<li>Request handling</li>
									<li>Output return</li>
									<li>Process termination</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Middleware<small><a href="http://silex.sensiolabs.org/doc/middlewares.html">&#9873;</a></small> = code executed in between the stages
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Middlewares can be global, or only for a specific route
								<ul>
									<li>Application middleware</li>
									<li>Route specific middleware</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Before Application Middleware</h2>

						<blockquote class="fragment" style="width: 100%">A before application middleware allows you to tweak the Request before the controller is executed</blockquote>

						<ul style="margin-top: 1em;">
							<li class="fragment">
								Example
								<pre class="bigger"><code class="language-php" style="overflow: scroll;">$app-&gt;before(function (Request $request) use ($app) {
	<span style="white-space: nowrap;">$app['twig']-&gt;addGlobal('first_url_part', explode('/', $request-&gt;getPathInfo())[1]);</span>
});</code></pre>
							</li>
							<li class="fragment">
								By default, the middleware is run after the routing and the security. To let it execute earlier use
								<pre class="bigger"><code class="language-php">$app-&gt;before(function (Request $request) use ($app) {
	// ...
}, Application::EARLY_EVENT);</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>After Application Middleware</h2>

						<blockquote class="fragment" style="width: 100%">An after application middleware allows you to tweak the Response before it is sent to the client</blockquote>

						<ul style="margin-top: 1em;">
							<li class="fragment">
								Example
								<pre class="bigger"><code class="language-php">$app-&gt;after(function (Request $request) use ($app) {
	// ...
});</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Finish Application Middleware</h2>

						<blockquote class="fragment" style="width: 100%">A finish application middleware allows you to execute tasks after the Response has been sent to the client (like sending emails or logging)</blockquote>

						<ul style="margin-top: 1em;">
							<li class="fragment">
								Example
								<pre class="bigger"><code class="language-php">$app-&gt;finish(function (Request $request, Response $response) {
	// Warning: modifications to the Request or Response will be ignored
});</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Example</h2>

						<figure><img src="assets/05/example-09.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at <code>assets/ws2-sws-fiddles-silex/09.middlewares/</code> <a href="assets/ws2-sws-fiddles-silex/09.middlewares/">&rarr;</a></p>
					</section>

					<section>
						<h2>Before Route Middleware</h2>

						<blockquote class="fragment" style="width: 100%">A before route middleware is fired just before the route callback, but after the before application middlewares</blockquote>

						<ul style="margin-top: 1em;">
							<li class="fragment">
								Example
								<pre class="bigger"><code class="language-php" style="overflow: scroll;">$app->get('/somewhere', function () {
	// ...
})->before(function (Request $request) use ($app) {
	// ...
});</code></pre>
							</li>
							<li class="fragment">
								Example <em>(using a controller)</em>
								<pre class="bigger"><code class="language-php">public function connect(Application $app) {
	return $app['controllers_factory']-&gt;get('/somewhere',
	       array($this,'somewhere')-&gt;before(array($this,'check'));
}

public function check(Request $request, Application $app) { /* ... */ }</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>After Route Middleware</h2>

						<blockquote class="fragment" style="width: 100%">An after route middleware is fired just after the route callback, but before the application its after application middlewares</blockquote>

						<ul style="margin-top: 1em;">
							<li class="fragment">
								Example
								<pre class="bigger"><code class="language-php">$app->get('/somewhere', function () {
	// ...
})->after(function (Request $request, Response $response) use ($app) {
	// ...
});</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Example</h2>

						<p style="margin-top: 4.5em;"><em>See further ;-)</em></p>
					</section>

				</section>



				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:bramus.vandamme@kahosl.be">bramus.vandamme@kahosl.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>
							<li><a href="#">...</a></li>
						</ul>
					</section>
				</section>

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>